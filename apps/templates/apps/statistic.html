{% extends 'apps/base.html' %}

{% block content %}

<div class="container my-4">
    <h3 class="mb-4 text-center">Statistiques générales</h3>

    <div class="row g-4">
        <div class="col-md-4">
            <div class="card text-center shadow-sm">
                <div class="card-body">
                    <h5 class="card-title">Fichiers importés</h5>
                    <p class="display-6">{{ total_files }}</p>
                </div>
            </div>
        </div>

        <div class="col-md-4">
            <div class="card text-center shadow-sm">
                <div class="card-body">
                    <h5 class="card-title">Mots avant nettoyage</h5>
                    <p class="display-6">{{ total_words_before }}</p>
                </div>
            </div>
        </div>

        <div class="col-md-4">
            <div class="card text-center shadow-sm">
                <div class="card-body">
                    <h5 class="card-title">Mots après nettoyage</h5>
                    <p class="display-6">{{ total_words_after }}</p>
                </div>
            </div>
        </div>
    </div>

    <div class="row g-4 mt-4">
        <div class="col-md-6">
            <div class="card shadow-sm">
                <div class="card-body">
                    <h5 class="card-title">Répartition par type de fichier</h5>
                    <canvas id="fileTypeChart"></canvas>
                </div>
            </div>
        </div>

        <div class="col-md-6">
            <div class="card shadow-sm">
                <div class="card-body">
                    <h5 class="card-title">10 mots les plus fréquents</h5>
                    <canvas id="wordFreqChart"></canvas>
                </div>
            </div>
        </div>
    </div>

    <div class="row g-4 mt-4">
        <div class="col-12">
            <div class="card shadow-sm">
                <div class="card-body text-center">
                    <h5 class="card-title mb-5">Nuage des 50 mots les plus fréquents</h5>
                    <img src="data:image/png;base64,{{ wordcloud_image }}" alt="Nuage de mots" class="img-fluid">
                </div>
            </div>
        </div>
    </div>
</div>


<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    const filetype_labels = {{ filetype_labels|safe }};
    const filetype_values = {{ filetype_values|safe }};

    const colorMap = {
        '.pdf': '#D32026',
        '.docx': '#185ABD',
        '.txt': '#6c757d'
    };

    // Générer un tableau de couleurs dans le bon ordre
    const backgroundColors = filetype_labels.map(ext => colorMap[ext] || '#999999');

    const fileTypeData = {
        labels: filetype_labels,
        datasets: [{
            data: filetype_values,
            backgroundColor: backgroundColors
        }]
    };

    const wordFreqData = {
        labels: {{ word_labels|safe }},
        datasets: [{
            data: {{ word_values|safe }},
            backgroundColor: '#0d6efd'
        }]
    };

    new Chart(document.getElementById('fileTypeChart'), {
        type: 'pie',
        data: fileTypeData
    });

    new Chart(document.getElementById('wordFreqChart'), {
        type: 'bar',
        data: wordFreqData
    });
</script>

{% endblock %}
